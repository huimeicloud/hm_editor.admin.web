<div class="box">
  <div class="left">
    <span class="title">数据集列表</span>
    <div style="margin: 3px 0 0 10px;height: 24px;">
      <span style="font-size: 14px;">数据集共：{{dictRecord['total']}}</span>
      <input style="width: 200px;float: right;height: 22px;" pInputText type="text" [(ngModel)]="dictFilterText"
        [ngModelOptions]="{standalone: true}" (keyup)="dictFilterBlur($event)" placeholder="编码/名称" />
    </div>

    <p-dataTable [style]="{'max-height': '100%','overflow':'auto','text-align':'center','width':'100%'}" [value]="dictRecord['data']"
      selectionMode="single" [paginator]="true" [rows]="dictPageSize" [totalRecords]="dictRecord['total']"
      fixedPaginator="true" scrollable="true" [pageLinks]="3" (onRowSelect)="dictRowSel($event)" [(selection)]="selDict"
      emptyMessage="暂无数据" [(first)]="dictFirst" [lazy]="true" (onLazyLoad)="loadDictLazy($event)">
      <p-column header="数据集编码" field="code"></p-column>
      <p-column header="数据集名称" field="name"></p-column>
      <p-column header="引用数" field="count" [style]="{'width':'60px'}"></p-column>
      <!-- <p-column header="版本号" field="version" [style]="{'width':'60px'}"></p-column> -->


    </p-dataTable>
    <div class="ops">

      <button pButton label="增加" icon="fa-plus" (click)="addDsDict()"></button>
      <button pButton label="修改" icon="icon iconfont icon-edit1" (click)="editDsDict()"></button>
      <button pButton label="删除" icon="icon iconfont icon-delete" (click)="delDict()"></button>
    </div>
  </div>
  <div class="right">
    <!-- <div>
      <span class="title">数据集版本管理</span>
      <div class="ops">
        <button pButton label="增加" icon="fa-plus" (click)="addDsDictVersion()"></button>
        <button pButton label="发布" icon="fa-plus" (click)="publishDictVersion()"></button>
      </div>
      <p-dataTable [style]="{'max-height': '100%','overflow':'auto','text-align':'center'}" [value]="versionList"
        fixedPaginator="true" scrollable="true" selectionMode="single" (onRowSelect)="dsDictVersionSelRow($event)"
        [(selection)]="selVersion">
        <p-column header="版本号" field="version"> </p-column>
        <p-column header="发布时间" field="publishDate">
          <ng-template let-col let-patient="rowData" let-index="rowIndex" pTemplate="body">
            <span>{{patient['publishTime'] | date:'y-MM-dd HH:mm'}}</span>
          </ng-template>
        </p-column>
        <p-column header="发布人" field="publishUser"></p-column>
      </p-dataTable>

    </div> -->
    <div>
      <span class="title">数据集包含数据元</span>
      <div style="    display: flex;align-items: center">
      <div style="flex: 1;">包含数量：{{verDataListBak.length}}
        <input style="width: 200px;float: right;" pInputText type="text" [(ngModel)]="verDataFilterTxt"
        [ngModelOptions]="{standalone: true}" (keyup)="verDataBlur($event)" placeholder="数据元编码/名称" />
      </div>

      <div class="ops" style="width: 220px;">
        <button pButton label="增加" icon="fa-plus" (click)="addDictVerDataRow()"></button>
        <button pButton label="修改" icon="icon iconfont icon-edit1" (click)="editorDictVerDataRow()"></button>
        <button pButton label="删除" icon="icon iconfont icon-delete" (click)="delVerDataRow()"></button>
      </div>
    </div>
      <p-dataTable [style]="{'max-height': '100%','overflow':'auto','text-align':'center'}" [value]="verShowDataList"
        fixedPaginator="true" scrollable="true" selectionMode="single" [(selection)]="selVersionData">
        <p-column header="类型" field="remark"></p-column>
        <p-column header="编码" field="refCode"></p-column>
        <p-column header="名称" field="name"></p-column>
      </p-dataTable>
      <p-paginator [first]="paginateInfo['first']" [rows]="paginateInfo['pageSize']"
    [rowsPerPageOptions]="[5,10,20]" [totalRecords]="paginateInfo['totalNum']" pageLinkSize="3"
    (onPageChange)="lazyVerData($event)"></p-paginator>

    </div>
    <div>
      <span class="title">数据集引用情况</span>
      <p-dataTable [style]="{'max-height': '100%','overflow':'auto','text-align':'center'}" [value]="refrenceList"
        fixedPaginator="true" scrollable="true">
        <!-- <p-column header="医院名称" field="code"></p-column> -->
        <p-column header="模板名称" field="name"></p-column>
      </p-dataTable>


    </div>
  </div>

  <!-- 值域 -->
  <p-dialog [header]="dsDictDiagTitle" [(visible)]="dsDictDiag" modal="true" closeOnEscape="false" [responsive]="true">
    <div class="row">
      <label>数据集编码</label><input pInputText type="text" [(ngModel)]="editorDsDict['code']"
        [ngModelOptions]="{standalone: true}" [disabled]="!!editorDsDict['_id']" />
    </div>
    <div class="row">
      <label>数据集名称</label><input pInputText type="text" [(ngModel)]="editorDsDict['name']"
        [ngModelOptions]="{standalone: true}" />
    </div>

    <div class="ops center">
      <button pButton label="确认" icon="iconfont icon-ensure" (click)="confirmEditDict()"></button>
      <button pButton label="取消" icon="iconfont icon-cancel" (click)="this.dsDictDiag = false"></button>
    </div>
  </p-dialog>


  <p-dialog [header]="dsDictVerDataDiagTitle" [(visible)]="dsDictVerDataDiag" modal="true" closeOnEscape="false"
    [responsive]="true">
    <div class="row" style="width: 300px;" *ngIf="editorDsDictVerData['_id']">
      <label style="min-width: 100px;">{{'原'+editorDsDictVerData['remark']+'名称'}}</label>
      <label style="min-width: 100px;width: unset;">{{editorDsDictVerData['name']}}</label>
    </div>
    <div class="row" style="width: 300px;display: none;">
      <label style="min-width: 100px;">类型</label>
      <p-dropdown [options]="types" [(ngModel)]="selType" filter="true" appendTo="body"  [style]="{'height': '22px','width': '140px'}">
        <ng-template let-item pTemplate="selectedItem">
            <span style="vertical-align:middle; margin-left: .5em">{{item.label}}</span>
        </ng-template>
        <ng-template let-car pTemplate="item">
            <div class="ui-helper-clearfix" style="position: relative;height: 24px;display: flex;">
                <div style="margin-top:4px">{{car.label}}</div>
            </div>
        </ng-template>
    </p-dropdown>
    </div>
    <div class="row" *ngIf="selType == '数据元'"  style="width: 300px;">
      <label style="min-width: 100px;">数据元</label>
      <kyee-all-datatsource-dp [(ngModel)]="selDs" [notShowCode]="notShowCode"></kyee-all-datatsource-dp>
    </div>
    <div class="row" *ngIf="selType == '数据组'"  style="width: 300px;">
      <label style="min-width: 100px;">数据组</label>
      <p-dropdown [options]="dropGroup" [(ngModel)]="selDs" filter="true" appendTo="body"  [style]="{'height': '22px','width': '140px'}"  filterBy="label,value">
        <ng-template let-item pTemplate="selectedItem">
            <span style="vertical-align:middle; margin-left: .5em">{{item.label}}</span>
        </ng-template>
        <ng-template let-car pTemplate="item">
            <div class="ui-helper-clearfix" style="position: relative;height: 24px;display: flex;">
                <div style="margin-top:4px">{{car.label}}</div>
                <div style="margin-top:4px;margin-left: 10px;">{{car.value}}</div>
            </div>
        </ng-template>
    </p-dropdown>
    </div>


    <div class="ops center" style="text-align: center;">
      <button pButton label="确认" icon="iconfont icon-ensure" (click)="confirmDictVerData()"></button>
      <button pButton label="取消" icon="iconfont icon-cancel" (click)="this.dsDictVerDataDiag = false"></button>
    </div>

  </p-dialog>
</div>
<p-growl [(value)]="msgs" [life]=5000></p-growl>